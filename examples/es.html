<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  />
  <title>PYPJS ESM Example</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans',
        Helvetica, Arial, sans-serif;
      padding: 20px;
      background-color: #f6f8fa;
      min-height: 100vh;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 40px;
      color: #24292f;
    }

    .demo-section {
      background: white;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .demo-section h2 {
      font-size: 18px;
      margin-bottom: 16px;
      color: #24292f;
    }

    .btn {
      padding: 12px 24px;
      background-color: #238636;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      width: 100%;
      margin-bottom: 12px;
      transition: background-color 0.2s ease;
    }

    .btn:hover {
      background-color: #2ea043;
    }

    .info {
      margin-top: 16px;
      padding: 12px;
      background-color: #f6f8fa;
      border-radius: 6px;
      font-size: 14px;
      color: #57606a;
      line-height: 1.6;
    }

    #eventInfo {
      margin-top: 16px;
      padding: 12px;
      background-color: #dafbe1;
      border-radius: 6px;
      font-size: 14px;
      color: #1a7f37;
      word-break: break-all;
    }

    @media (prefers-color-scheme: dark) {
      body {
        background-color: #0d1117;
      }

      h1 {
        color: #e6edf3;
      }

      .demo-section {
        background: #161b22;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      }

      .demo-section h2 {
        color: #e6edf3;
      }

      .info {
        background-color: #161b22;
        color: #8b949e;
      }

      #eventInfo {
        background-color: #1c2128;
        color: #3fb950;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>PYPJS ESM Example</h1>

    <div class="demo-section">
      <h2>Basic Usage (ES Module) - New Selection Sections API</h2>
      <button
        class="btn"
        onclick="openPanel()"
      >Open Selection Panel</button>
      <div class="info">
        This example demonstrates ESM import usage with the new setSelectionSections() API:<br />
        <code>import pypjs from '../dist/index.esm.js'</code><br />
        <br />
        The new API supports:<br />
        â€¢ Multiple custom selection sections<br />
        â€¢ Each section can be single or multiple selection mode<br />
        â€¢ Set key property to customize field names (recommended to use English keys)<br />
        â€¢ Single mode defaults to first item, or use defaultValue<br />
        â€¢ Get all selections from all sections on submit (using key or numeric index)
      </div>
      <div id="eventInfo"></div>
    </div>
  </div>

  <script type="module">
    import pypjs from '../dist/index.esm.js'

    // Selection sections (new API with single/multiple selection)
    const selectionSections = [
      {
        key: 'paymentMethod', // Custom key for easy code access
        title: 'Select Payment Method',
        multiple: false, // Single selection
        defaultValue: 2, // Default to Alipay
        items: [
          { id: 1, name: 'WeChat Pay', desc: 'Recommended', icon: 'ðŸ’³' },
          { id: 2, name: 'Alipay', desc: 'Secure & Convenient', icon: 'ðŸ’°' },
          { id: 3, name: 'Apple Pay', desc: 'Fast Payment', icon: 'ðŸŽ' }
        ]
      },
      {
        key: 'bankCard', // Custom key
        title: 'Select Bank Card',
        multiple: false, // Single selection
        // No defaultValue, defaults to first item
        items: [
          { id: 4, name: 'CMB Bank (ending 1234)', desc: 'Debit Card', icon: 'ðŸ’µ' },
          { id: 5, name: 'ICBC Bank (ending 5678)', desc: 'Credit Card', icon: 'ðŸ’³' }
        ]
      },
      {
        key: 'coupons', // Custom key (multiple selection)
        title: 'Select Coupons',
        multiple: true, // Multiple selection
        // No default for multiple selection
        items: [
          { id: 6, name: '$10 off $100', desc: 'All items', icon: 'ðŸŽ«' },
          { id: 7, name: '$30 off $200', desc: 'All items', icon: 'ðŸŽ«' }
        ]
      },
      {
        key: 'delivery', // Custom key
        title: 'Select Delivery Method',
        multiple: false, // Single selection
        defaultValue: 9, // Default to Express Delivery
        items: [
          { id: 8, name: 'Standard Delivery', desc: '3-5 days', icon: 'ðŸ“¦' },
          { id: 9, name: 'Express Delivery', desc: '1-2 days', icon: 'ðŸš€' }
        ]
      }
    ]

    // Event handler
    pypjs.on('confirm', (e) => {
      const { selections, selectionsData, amount } = e.detail
      const info = document.getElementById('eventInfo')
      let message = `Confirmed: Amount=$${amount}\n\nSelections:\n`

      for (const [key, value] of Object.entries(selections)) {
        if (Array.isArray(value)) {
          message += `${key}: ${value.join(', ')}\n`
        } else {
          message += `${key}: ${value}\n`
        }
      }

      if (info) {
        info.textContent = message
      }
      console.log('All selections:', selections, selectionsData)
      pypjs.close()
    })

    pypjs.on('close', () => {
      console.log('Panel closed')
    })

    // Open panel function (using new setSelectionSections API)
    window.openPanel = function () {
      pypjs.setSelectionSections(selectionSections, {
        titleField: 'name',
        subtitleField: 'desc',
        iconField: 'icon',
        valueField: 'id'
      })
      pypjs.open(99.99)
    }

    // Legacy API example (for backward compatibility)
    // You can still use setPaymentMethods() with children for grouping:
    /*
    pypjs.setPaymentMethods([
      {
        name: 'Online Payment',
        children: [
          { id: 1, name: 'WeChat Pay', desc: 'Recommended', icon: 'ðŸ’³' },
          { id: 2, name: 'Alipay', desc: 'Secure', icon: 'ðŸ’°' }
        ]
      }
    ], {
      titleField: 'name',
      subtitleField: 'desc',
      iconField: 'icon',
      valueField: 'id'
    })
    */
  </script>
</body>

</html>
